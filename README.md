# ProcTail

ProcTailã¯ã€Windowsç’°å¢ƒã§ETW (Event Tracing for Windows) ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨å­ãƒ—ãƒ­ã‚»ã‚¹ä½œæˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

## âœ¨ ç‰¹å¾´

- ğŸ” **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–**: ETWã‚’ä½¿ç”¨ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®å³åº§ãªæ¤œå‡º
- ğŸ·ï¸ **ã‚¿ã‚°ãƒ™ãƒ¼ã‚¹ç®¡ç†**: ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚¿ã‚°ã§åˆ†é¡ã—ã¦åŠ¹ç‡çš„ã«ç®¡ç†
- ğŸ”§ **CLI & ã‚µãƒ¼ãƒ“ã‚¹**: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã¨Windowsã‚µãƒ¼ãƒ“ã‚¹ã®ä¸¡æ–¹ã§åˆ©ç”¨å¯èƒ½
- ğŸ›¡ï¸ **ç®¡ç†è€…æ¨©é™å¯¾å¿œ**: å¿…è¦ã«å¿œã˜ã¦è‡ªå‹•ã§UACãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º
- ğŸ“Š **å¤šæ§˜ãªå‡ºåŠ›å½¢å¼**: Tableã€JSONã€CSVå½¢å¼ã§ã®çµæœå‡ºåŠ›
- ğŸ”„ **Named Pipes IPC**: ãƒ—ãƒ­ã‚»ã‚¹é–“é€šä¿¡ã«ã‚ˆã‚‹åˆ¶å¾¡ãƒ»æƒ…å ±å–å¾—

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
1. æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. ç®¡ç†è€…æ¨©é™ã§ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ã
3. ProcTailã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»é–‹å§‹

```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨é–‹å§‹
proctail service install
proctail service start

# ç›£è¦–å¯¾è±¡ã‚’è¿½åŠ 
proctail add --name "notepad.exe" --tag "demo"

# ãƒ¡ãƒ¢å¸³ã‚’èµ·å‹•ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚’å®Ÿè¡Œ
notepad.exe

# ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèª
proctail events --tag "demo"
```

## ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- **[ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰](docs/user/Quick-Start.md)** - 5åˆ†ã§å§‹ã‚ã‚‹
- **[CLIä½¿ç”¨æ–¹æ³•](docs/user/CLI-Usage.md)** - è©³ç´°ãªä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰  
- **[ã‚³ãƒãƒ³ãƒ‰ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](docs/user/CLI-Reference.md)** - å…¨ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§

### ğŸ‘¨â€ğŸ’» é–‹ç™ºè€…å‘ã‘
- **[é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰](docs/developer/Developer-Guide.md)** - C#åˆå¿ƒè€…å‘ã‘é–‹ç™ºã‚¬ã‚¤ãƒ‰
- **[ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](docs/developer/Architecture.md)** - ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã¨æŠ€è¡“é¸æŠ

### ğŸ”Œ APIä»•æ§˜
- **[API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](docs/api/API-Reference.md)** - IPCé€šä¿¡ã¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

## ğŸ’» CLIä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªç›£è¦–
```bash
# ãƒ—ãƒ­ã‚»ã‚¹IDã§ç›£è¦–
proctail add --pid 1234 --tag "my-app"

# ãƒ—ãƒ­ã‚»ã‚¹åã§ç›£è¦–
proctail add --name "chrome.exe" --tag "browser"

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
proctail events --tag "browser" --follow
```

### é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨é€”
```bash
# Visual Studioé–¢é€£ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç›£è¦–
proctail add --name "devenv.exe" --tag "development"
proctail add --name "MSBuild.exe" --tag "development"

# ãƒ“ãƒ«ãƒ‰ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚’ç¢ºèª
proctail events --tag "development" --count 100
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
```bash
# ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç›£è¦–
proctail add --name "winlogon.exe" --tag "security"
proctail add --name "lsass.exe" --tag "security"

# CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦åˆ†æ
proctail events --tag "security" --format csv > audit.csv
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Named Pipes     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI Client    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  ProcTail Host   â”‚
â”‚   proctail.exe  â”‚                    â”‚  (Windows Service) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â”‚ ETW Events
                                                â–¼
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚ Windows Kernel  â”‚
                                       â”‚ (ETW Providers) â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **ProcTail.Host**: ETWç›£è¦–ã¨Named Pipesã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹Windowsã‚µãƒ¼ãƒ“ã‚¹
- **ProcTail.Cli**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼face
- **ProcTail.Core**: å…±é€šã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ãƒ¢ãƒ‡ãƒ«å®šç¾©
- **ProcTail.Infrastructure**: ETWã¨Named Pipesã®Windows APIå®Ÿè£…
- **ProcTail.Application**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ã‚µãƒ¼ãƒ“ã‚¹å±¤

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨æ¨©é™

### å¿…è¦ãªæ¨©é™
- **ETWç›£è¦–**: Windowsç®¡ç†è€…æ¨©é™ãŒå¿…è¦
- **Named Pipes**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
- **ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†**: ç®¡ç†è€…æ¨©é™ãŒå¿…è¦

### UACå¯¾å¿œ
æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã€è‡ªå‹•çš„ã«UACãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```bash
# ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ãªå ´åˆã€UACãŒè‡ªå‹•è¡¨ç¤º
proctail service start

# UACã‚’ç„¡åŠ¹ã«ã™ã‚‹å ´åˆ
proctail service start --no-uac
```

## ğŸ“Š ç›£è¦–å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ

| ã‚¤ãƒ™ãƒ³ãƒˆç¨®é¡ | èª¬æ˜ |
|-------------|------|
| **ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ** | Create, Write, Delete, Rename, SetInfo |
| **ãƒ—ãƒ­ã‚»ã‚¹æ“ä½œ** | Process Start, Process End |
| **å­ãƒ—ãƒ­ã‚»ã‚¹** | è¦ªãƒ—ãƒ­ã‚»ã‚¹ã¨åŒã˜ã‚¿ã‚°ã§è‡ªå‹•ç›£è¦– |

*æ³¨æ„: ãƒ•ã‚¡ã‚¤ãƒ«Readæ“ä½œã¯é«˜é »åº¦ã®ãŸã‚é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™*

## âš™ï¸ è¨­å®š

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹ (appsettings.json)
```json
{
  "ProcTail": {
    "MaxEventsPerTag": 10000,
    "EventRetentionDays": 30,
    "DataDirectory": "C:\\ProcTail\\Data"
  },
  "Etw": {
    "SessionName": "ProcTailSession",
    "BufferSizeKB": 1024
  },
  "NamedPipe": {
    "PipeName": "ProcTailIPC",
    "MaxConcurrentConnections": 10
  }
}
```

## ğŸ§ª ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

- **OS**: Windows 10/11 ã¾ãŸã¯ Windows Server 2019/2022
- **Framework**: .NET 8.0 Runtime
- **æ¨©é™**: ç®¡ç†è€…æ¨©é™ï¼ˆETWç›£è¦–ä½¿ç”¨æ™‚ï¼‰
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: x64

## ğŸ”§ é–‹ç™ºãƒ»ãƒ“ãƒ«ãƒ‰

### å‰ææ¡ä»¶
- .NET 8.0 SDK
- Visual Studio 2022 ã¾ãŸã¯ VS Code
- Windows é–‹ç™ºç’°å¢ƒ

### ãƒ“ãƒ«ãƒ‰
```bash
# å…¨ä½“ã‚’ãƒ“ãƒ«ãƒ‰
dotnet build

# CLIãƒ„ãƒ¼ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰
dotnet build src/ProcTail.Cli/

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet test
```

### é–‹ç™ºç”¨ã®å®Ÿè¡Œ
```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
dotnet run --project src/ProcTail.Host/

# CLIã‚’å®Ÿè¡Œ
dotnet run --project src/ProcTail.Cli/ -- add --name "notepad.exe" --tag "debug"
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª
- **Unit**: å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å®Ÿè¡Œå¯èƒ½
- **Integration**: ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸçµ±åˆãƒ†ã‚¹ãƒˆ
- **System**: Windowsç’°å¢ƒå¿…é ˆ
- **System+RequiresWindowsAndAdministrator**: Windows+ç®¡ç†è€…æ¨©é™å¿…é ˆ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet test

# ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ãƒ†ã‚¹ãƒˆ
dotnet test --filter TestCategory=Platform

# Windowså›ºæœ‰ãƒ†ã‚¹ãƒˆï¼ˆç®¡ç†è€…æ¨©é™ã§å®Ÿè¡Œï¼‰
dotnet test --filter TestCategory=System
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆå‚è€ƒå€¤ï¼‰
- **ETWã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†**: ~10,000 events/sec
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ~50MB (10,000 events)
- **CPUä½¿ç”¨ç‡**: <5% (é€šå¸¸ç›£è¦–æ™‚)
- **Named Pipeå¿œç­”**: <10ms

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

### é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- ã‚³ãƒ¼ãƒ‰ã¯æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆæ¨å¥¨
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç¶­æŒ
- Windowså›ºæœ‰æ©Ÿèƒ½ã¯ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å±æ€§ã‚’ä½¿ç”¨
- UACãŒå¿…è¦ãªæ©Ÿèƒ½ã¯é©åˆ‡ã«æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ MIT License ã®ä¸‹ã§é…å¸ƒã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ [LICENSE](LICENSE) ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ™ è¬è¾

- [Microsoft.Diagnostics.Tracing.TraceEvent](https://github.com/Microsoft/perfview) - ETWå‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- [System.CommandLine](https://github.com/dotnet/command-line-api) - CLIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [NUnit](https://nunit.org/) - ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

- **GitHub Issues**: [Issues](https://github.com/your-org/proctail/issues)
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [docs/](docs/)
- **Wiki**: [GitHub Wiki](https://github.com/your-org/proctail/wiki)

---

**âš¡ ProcTailã§Windowsç’°å¢ƒã®ãƒ—ãƒ­ã‚»ã‚¹ç›£è¦–ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼**